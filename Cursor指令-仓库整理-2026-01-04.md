# Cursor指令 - 仓库整理（2026-01-04）

@Codebase 整理仓库结构，保留所有文档内容，清理空文件夹，优化协作流程

---

## 任务目标

整理GitHub仓库（sanxiangwendao），实现：
1. 删除重复的YAML索引
2. 清理空文件夹
3. 更新关键文档说明
4. 优化.gitignore规则
5. 创建协作SOP

**核心原则**：
- ✅ 保留所有现有文档内容
- ✅ 只删除空文件夹
- ✅ 所有操作可验证、可回滚
- ✅ 不改变现有文档路径（除非必要）

---

## 执行步骤

### Step 1：备份当前状态（安全措施）

```bash
# 创建备份记录
echo "=== 仓库整理备份 - $(date) ===" > /tmp/repo_cleanup_backup.log

# 记录当前文件树
echo "文件树快照：" >> /tmp/repo_cleanup_backup.log
tree -L 3 -d >> /tmp/repo_cleanup_backup.log 2>/dev/null || find . -type d -maxdepth 3 >> /tmp/repo_cleanup_backup.log

# 记录当前YAML索引
echo "" >> /tmp/repo_cleanup_backup.log
echo "YAML索引快照：" >> /tmp/repo_cleanup_backup.log
ls -lh rag-index/indexes/*.yaml >> /tmp/repo_cleanup_backup.log

echo "✅ 备份记录已创建: /tmp/repo_cleanup_backup.log"
```

---

### Step 2：删除重复YAML索引（P0 - 必须执行）

```bash
echo ""
echo "=========================================="
echo "Step 2: 删除重复YAML索引"
echo "=========================================="

# 检查文件是否存在
if [ -f rag-index/indexes/DOC-S067.yaml ]; then
    echo "⚠️ 发现重复文件: DOC-S067.yaml"
    echo "内容预览:"
    head -5 rag-index/indexes/DOC-S067.yaml
    
    # 删除
    rm rag-index/indexes/DOC-S067.yaml
    echo "✅ 已删除: DOC-S067.yaml"
else
    echo "✅ DOC-S067.yaml 不存在（可能已删除）"
fi

if [ -f rag-index/indexes/DOC-S068.yaml ]; then
    echo "⚠️ 发现重复文件: DOC-S068.yaml"
    echo "内容预览:"
    head -5 rag-index/indexes/DOC-S068.yaml
    
    # 删除
    rm rag-index/indexes/DOC-S068.yaml
    echo "✅ 已删除: DOC-S068.yaml"
else
    echo "✅ DOC-S068.yaml 不存在（可能已删除）"
fi

# 验证删除结果
echo ""
echo "验证: 检查DOC-S04*和DOC-S06*索引"
ls -lh rag-index/indexes/DOC-S04*.yaml 2>/dev/null
echo "---"
ls -lh rag-index/indexes/DOC-S06*.yaml 2>/dev/null || echo "✅ 无DOC-S06*文件（正确）"

echo ""
echo "✅ Step 2 完成"
```

---

### Step 3：查找并清理空文件夹

```bash
echo ""
echo "=========================================="
echo "Step 3: 查找并清理空文件夹"
echo "=========================================="

# 创建临时文件记录空文件夹
EMPTY_DIRS="/tmp/empty_dirs.txt"
> $EMPTY_DIRS

# 查找空文件夹（排除.git目录）
find . -type d -empty -not -path "./.git/*" > $EMPTY_DIRS

# 显示找到的空文件夹
EMPTY_COUNT=$(wc -l < $EMPTY_DIRS)
echo "找到 $EMPTY_COUNT 个空文件夹："
cat $EMPTY_DIRS

if [ $EMPTY_COUNT -gt 0 ]; then
    echo ""
    echo "准备删除这些空文件夹..."
    echo "按回车继续，或Ctrl+C取消"
    read
    
    # 删除空文件夹
    while IFS= read -r dir; do
        if [ -d "$dir" ]; then
            rmdir "$dir" 2>/dev/null && echo "✅ 已删除: $dir" || echo "⚠️ 无法删除: $dir（可能不为空）"
        fi
    done < $EMPTY_DIRS
    
    echo "✅ 空文件夹清理完成"
else
    echo "✅ 没有发现空文件夹"
fi

echo ""
echo "✅ Step 3 完成"
```

---

### Step 4：更新shangye-anli/README.md（标注本地工作区模式）

```bash
echo ""
echo "=========================================="
echo "Step 4: 更新shangye-anli/README.md"
echo "=========================================="

# 备份原文件
cp shangye-anli/README.md shangye-anli/README.md.backup

# 在文件开头添加状态说明
cat > shangye-anli/README.md.new << 'EOF'
# 商业案例课改编（项目框架）

> **🔄 工作模式**：本地工作区模式  
> **📍 实际工作路径**：本地 `dedao/` 目录  
> **📦 本目录内容**：系统框架、指令模板、结构说明

---

## 📋 状态说明

**本目录定位**：
- ✅ 提供完整的系统框架和指令
- ✅ 定义标准化的案例拆解流程
- ✅ 作为版本控制和团队协作的基础
- ⚠️ 实际案例拆解工作在本地 `dedao/` 目录进行

**为什么采用本地工作区模式？**
1. **版权保护**：课程原文件不适合上传到公开仓库
2. **灵活迭代**：本地可以快速试错和调整
3. **清晰分工**：仓库管框架，本地管实战
4. **定期同步**：完成的案例可以同步回仓库（去除课程引用）

---

EOF

# 将原文件内容追加到新文件（从第一个标题开始）
sed -n '/^# 商业案例课改编/,$p' shangye-anli/README.md.backup | tail -n +2 >> shangye-anli/README.md.new

# 在文件末尾添加工作流说明
cat >> shangye-anli/README.md.new << 'EOF'

---

## 🔄 工作流程

### 本地工作（dedao/）

1. **拆解商业案例**：
   - 使用 `00_系统指令/Claude-案例拆解提示词.md`
   - 包含课程原文件作为材料
   - 快速迭代和验证

2. **提炼商业模型**：
   - 使用 `00_系统指令/Claude-模型提炼提示词.md`
   - 从多个案例中抽象可复用模型

3. **归纳跨案例洞察**：
   - 使用 `00_系统指令/Claude-洞察归纳提示词.md`
   - 对比多个案例，提炼共性

### 同步到仓库（定期）

**同步内容**：
- ✅ 新拆解的案例文档（**去除课程原文引用**）
- ✅ 新提炼的商业模型
- ✅ 新归纳的跨案例洞察
- ✅ 更新索引文件

**不同步内容**：
- ❌ 课程原文件（版权保护）
- ❌ 临时工作文件
- ❌ 个人笔记

**同步方法**：
参考 `99-gongjuSOP/协作/本地与仓库同步SOP.md`

---

## 📍 本地工作区路径

**推荐路径**：`~/dedao/`（或你的实际路径）

**快速开始**：
1. 查看本地 `dedao/README.md` 了解工作区结构
2. 查看本地 `dedao/本地工作区说明.md` 了解使用方法
3. 开始第一个案例拆解

---

**文档版本**：v2.0  
**最后更新**：2026-01-04  
**维护者**：常松阳
EOF

# 替换原文件
mv shangye-anli/README.md.new shangye-anli/README.md

echo "✅ shangye-anli/README.md 已更新"
echo ""
echo "变更对比："
echo "--- 旧版本（前5行）---"
head -5 shangye-anli/README.md.backup
echo ""
echo "--- 新版本（前15行）---"
head -15 shangye-anli/README.md

echo ""
echo "✅ Step 4 完成"
```

---

### Step 5：更新.gitignore（确保不上传本地工作文件）

```bash
echo ""
echo "=========================================="
echo "Step 5: 更新.gitignore"
echo "=========================================="

# 备份原文件（如果存在）
if [ -f .gitignore ]; then
    cp .gitignore .gitignore.backup
    echo "✅ 已备份 .gitignore"
fi

# 创建或更新.gitignore
cat > .gitignore << 'EOF'
# ============================================
# 本地工作区（dedao/不在仓库中）
# ============================================
dedao/
**/dedao/

# ============================================
# 课程原文件（版权保护）
# ============================================
**/*课程*.md
**/*dedao*.md
**/MD/*.md

# ============================================
# 临时文件
# ============================================
*.tmp
*.bak
*.backup
~*
.DS_Store
Thumbs.db
*.swp
*.swo

# ============================================
# Python相关
# ============================================
__pycache__/
*.py[cod]
*$py.class
.Python
venv/
.venv/
env/
ENV/
*.egg-info/
dist/
build/

# ============================================
# IDE配置
# ============================================
.vscode/
.idea/
*.sublime-project
*.sublime-workspace

# ============================================
# RAG系统临时文件
# ============================================
rag-system/data/
rag-system/*.db
rag-system/*.pkl
rag-system/chroma/

# ============================================
# 日志和数据库
# ============================================
*.log
*.sqlite
*.db

# ============================================
# 测试和覆盖率
# ============================================
.pytest_cache/
.coverage
htmlcov/
.tox/

# ============================================
# 系统文件
# ============================================
.env
.env.local
*.key
*.pem
secrets/
EOF

echo "✅ .gitignore 已更新"
echo ""
echo "新增规则："
echo "- dedao/ 本地工作区"
echo "- 课程原文件"
echo "- 临时和备份文件"
echo "- Python和IDE配置"
echo "- RAG系统临时文件"

echo ""
echo "✅ Step 5 完成"
```

---

### Step 6：更新根目录README.md（添加仓库结构说明）

```bash
echo ""
echo "=========================================="
echo "Step 6: 更新根目录README.md"
echo "=========================================="

# 备份原文件
cp README.md README.md.backup

# 在文件中查找合适的插入位置（在"## 🔗 文件关联网络"之前）
# 如果找不到，就在文件末尾添加

# 创建要插入的新章节
cat > /tmp/readme_insert.md << 'EOF'

---

## 📂 仓库结构说明

### 核心目录

- **`01-dao/`** - 道层理论（12篇）
  - 认知理念、核心理论、价值观
  - 如：认知内共生理论、双螺旋进化模型、财富创造的范式转移

- **`02-shu/`** - 术层方法（66篇）
  - 方法框架、执行技巧、实战案例
  - 细分：创新方法、产品设计、沟通技巧、行为改变、战略思维

- **`shangye-anli/`** - 商业案例框架
  - **模式**：本地工作区模式
  - **内容**：系统指令、流程框架、结构说明
  - **实际工作**：在本地 `dedao/` 目录进行
  - 包含：案例拆解/模型提炼/洞察归纳的完整方法论

- **`AI产品分析/`** - AI竞品分析框架
  - 10步完整流程（Why/Money/What/How/Growth）
  - 导师点评、评分系统、失败案例分析
  - 竞品库、追踪记录、改进清单

- **`99-gongjuSOP/`** - 工具和SOP文档
  - 写作规范：新文档写作框架指南、快速参考
  - 知识库管理：构建SOP、RAG索引重建
  - 协作流程：本地与仓库同步SOP（新增）

- **`rag-index/`** - RAG索引系统
  - YAML索引：78篇文档的完整元数据
  - 文档映射：doc-mapping.md（ID→路径）
  - 学习路径：5条主题学习路径

- **`rag-system/`** - RAG查询系统
  - Python实现的检索增强生成系统
  - 支持语义搜索、混合检索

- **`scripts/`** - 脚本工具
  - 索引构建、更新、验证脚本
  - 目录重组工具

- **`archive/`** - 归档文件
  - 旧版本指令
  - 已废弃文档

- **`training/`** - 培训材料
  - 知识库筛选方案
  - 团队培训文档

---

### 工作模式

本仓库采用**三空间协作模式**：

#### 1. GitHub仓库（知识资产库）

**职责**：
- ✅ 理论体系：78篇核心文档
- ✅ 子项目框架：shangye-anli/ AI产品分析/
- ✅ 工具文档：99-gongjuSOP/
- ✅ 版本控制：Git管理所有变更

**不包含**：
- ❌ 课程原文件（版权保护）
- ❌ 临时工作文件
- ❌ 个人笔记碎片

#### 2. 本地工作区（dedao/）

**职责**：
- ✅ 商业案例拆解
- ✅ 课程原文件（作为拆解材料）
- ✅ 实战练习和快速迭代

**工作流**：
1. 使用系统指令拆解案例
2. 提炼商业模型
3. 归纳跨案例洞察
4. 定期同步到仓库（去除课程引用）

**本地路径**：`~/dedao/`

#### 3. Claude Projects（AI协作界面）

**职责**：
- ✅ 日常AI协作
- ✅ 知识检索（Project Knowledge）
- ✅ 快速查询和分析

**数据来源**：
- 从GitHub仓库定期同步
- 不包含课程原文

---

### 同步机制

#### 本地→仓库（定期同步）

**同步内容**：
- ✅ 新拆解的案例文档（去除课程原文引用）
- ✅ 新提炼的商业模型
- ✅ 新归纳的跨案例洞察

**同步频率**：建议每周一次

**操作指南**：参考 `99-gongjuSOP/协作/本地与仓库同步SOP.md`

#### 仓库→本地（按需同步）

**同步内容**：
- ✅ 系统指令更新
- ✅ 框架文档更新
- ✅ 工具文档更新

**触发时机**：
- 系统指令有重大更新
- 框架方法论调整
- 新增工具或SOP

#### 仓库→Projects（定期同步）

**同步内容**：
- ✅ Project Knowledge更新
- ✅ 新文档索引
- ✅ 理论文档更新

**同步频率**：建议每月一次

---

### 版本管理

**文档版本规则**：
- 道层文档：DOC-D001 ~ DOC-D012
- 术层文档：DOC-S001 ~ DOC-S068
- 每篇文档有独立YAML索引

**Git提交规范**：
- `feat:` - 新增文档/功能
- `docs:` - 更新文档内容
- `chore:` - 更新索引/目录
- `refactor:` - 结构调整
- `fix:` - 修复问题

---

### 快速导航

| 需求 | 推荐路径 |
|------|---------|
| **学习理论** | `01-dao/` + `02-shu/` + `rag-index/learning-paths.md` |
| **拆解商业案例** | 本地 `dedao/` + `shangye-anli/00_系统指令/` |
| **分析AI产品** | `AI产品分析/AI产品竞品分析/00_系统指令/` |
| **写作新文档** | `99-gongjuSOP/写作/新文档写作框架指南.md` |
| **构建知识库** | `99-gongjuSOP/知识库/知识库构建SOP.md` |
| **RAG检索** | `rag-system/` + `rag-index/` |

EOF

# 查找插入位置（在"## 🔗 文件关联网络"之前）
if grep -q "## 🔗 文件关联网络" README.md; then
    # 找到了标记，在其前面插入
    sed -i.bak '/## 🔗 文件关联网络/r /tmp/readme_insert.md' README.md
    echo "✅ 已在'文件关联网络'章节前插入新内容"
else
    # 没找到标记，在文件末尾添加
    cat /tmp/readme_insert.md >> README.md
    echo "✅ 已在文件末尾添加新内容"
fi

echo ""
echo "新增章节："
echo "- 📂 仓库结构说明"
echo "- 工作模式（三空间协作）"
echo "- 同步机制"
echo "- 版本管理"
echo "- 快速导航"

echo ""
echo "✅ Step 6 完成"
```

---

### Step 7：创建同步SOP文档

```bash
echo ""
echo "=========================================="
echo "Step 7: 创建同步SOP文档"
echo "=========================================="

# 创建目录（如果不存在）
mkdir -p 99-gongjuSOP/协作

# 创建同步SOP文档
cat > 99-gongjuSOP/协作/本地与仓库同步SOP.md << 'EOF'
# 本地与仓库同步SOP

> **用途**：规范本地dedao/与GitHub仓库的同步流程  
> **频率**：建议每周同步一次  
> **维护者**：常松阳

---

## 🎯 同步原则

### 核心规则

1. **本地→仓库**：
   - ✅ 同步：完成的案例/模型/洞察
   - ❌ 不同步：课程原文、临时文件、个人笔记

2. **仓库→本地**：
   - ✅ 同步：系统指令更新、框架调整
   - 触发：按需同步（有重大更新时）

3. **质量标准**：
   - 文档必须完整（所有必要章节）
   - 已去除课程原文引用
   - 索引已更新
   - 文件命名符合规范

---

## 📤 从本地同步到仓库

### 场景1：新拆解的商业案例

**前置检查**：
- [ ] 案例文档已完成（包含所有必要部分）
- [ ] 已去除课程原文直接引用（改为"根据课程材料整理"）
- [ ] 已更新本地的 `案例总索引.md`
- [ ] 文件命名符合规范：`<企业名>-<关键词>.md`

**同步步骤**：

```bash
# 1. 从本地复制案例到仓库
cp ~/dedao/01_案例库/按行业分类/<行业>/<案例文件>.md \
   ~/sanxiangwendao/shangye-anli/01_案例库/按行业分类/<行业>/

# 2. 更新仓库的案例总索引
# 手动编辑 shangye-anli/01_案例库/案例总索引.md
# 添加新案例条目

# 3. Git提交
cd ~/sanxiangwendao
git add shangye-anli/01_案例库/
git commit -m "feat: 新增<企业名>案例拆解"
git push
```

**质量检查**：
- [ ] 案例文档无课程原文引用
- [ ] 案例总索引已更新
- [ ] Git提交信息清晰

---

### 场景2：新提炼的商业模型

**前置检查**：
- [ ] 模型文档已完成
- [ ] 包含：机制、变量、边界、验证方式
- [ ] 至少有2-3个支撑案例
- [ ] 已更新本地的 `模型总索引.md`

**同步步骤**：

```bash
# 1. 从本地复制模型到仓库
cp ~/dedao/02_模型库/<类型>/<模型文件>.md \
   ~/sanxiangwendao/shangye-anli/02_模型库/<类型>/

# 2. 更新仓库的模型总索引
# 手动编辑 shangye-anli/02_模型库/模型总索引.md

# 3. Git提交
cd ~/sanxiangwendao
git add shangye-anli/02_模型库/
git commit -m "feat: 新增<模型名>商业模型"
git push
```

---

### 场景3：新归纳的跨案例洞察

**前置检查**：
- [ ] 洞察文档已完成
- [ ] 包含：主题、机制、可证伪条件、验证计划
- [ ] 至少对比2-3个案例
- [ ] 已更新本地的 `洞察总索引.md`

**同步步骤**：

```bash
# 1. 从本地复制洞察到仓库
cp ~/dedao/03_洞察库/<洞察文件>.md \
   ~/sanxiangwendao/shangye-anli/03_洞察库/

# 2. 更新仓库的洞察总索引
# 手动编辑 shangye-anli/03_洞察库/洞察总索引.md

# 3. Git提交
cd ~/sanxiangwendao
git add shangye-anli/03_洞察库/
git commit -m "feat: 新增<主题>跨案例洞察"
git push
```

---

## 📥 从仓库同步到本地

### 场景1：系统指令更新

**触发条件**：
- 系统指令有重大更新（如新增步骤、调整框架）
- 收到团队通知

**同步步骤**：

```bash
# 1. 从仓库拉取最新版本
cd ~/sanxiangwendao
git pull

# 2. 复制更新的系统指令到本地
cp shangye-anli/00_系统指令/*.md ~/dedao/00_系统指令/

# 3. 验证本地工作区使用最新指令
echo "✅ 系统指令已更新到最新版本"
ls -lh ~/dedao/00_系统指令/
```

---

### 场景2：框架文档更新

**触发条件**：
- README有重要调整
- 流程规范有变化

**同步步骤**：

```bash
# 1. 从仓库拉取最新版本
cd ~/sanxiangwendao
git pull

# 2. 复制更新的README到本地
cp shangye-anli/README.md ~/dedao/
cp shangye-anli/01_案例库/README.md ~/dedao/01_案例库/
# ... 其他需要的README

# 3. 调整本地工作流（如有需要）
echo "✅ 框架文档已同步"
```

---

## ⚠️ 注意事项

### 禁止同步的内容

**从本地→仓库（禁止）**：
- ❌ 课程原文件（`04_原著笔记/MD/*.md`）
- ❌ 临时工作文件（`*.tmp`, `*.bak`）
- ❌ 个人笔记（未经整理的碎片）
- ❌ 带有课程原文直接引用的案例

**从仓库→本地（通常不需要）**：
- ❌ 理论文档（01-dao/, 02-shu/）：本地通过Claude Projects访问即可
- ❌ RAG索引：本地不需要完整RAG系统

---

### 同步前检查清单

**文档质量**：
- [ ] 文档结构完整（所有必要章节）
- [ ] 内容符合质量标准
- [ ] 已去除课程原文引用
- [ ] 语言表达清晰、逻辑连贯

**索引更新**：
- [ ] 对应的总索引已更新（案例/模型/洞察）
- [ ] 索引信息准确（标题、路径、标签）

**文件规范**：
- [ ] 文件命名符合规范
- [ ] 存储路径正确
- [ ] Markdown格式正确

**Git提交**：
- [ ] 提交信息清晰（feat/docs/chore）
- [ ] 只提交相关文件
- [ ] 提交前已测试

---

## 📋 同步记录模板

建议在本地 `05_学习记录/` 维护同步记录：

```markdown
# 同步记录 - YYYY-MM-DD

## 本次同步内容

### 新增案例（X个）
- [企业名]-[关键词].md - [行业] - [状态]

### 新增模型（X个）
- [模型名].md - [类型] - [支撑案例数]

### 新增洞察（X个）
- 洞察[编号]-[主题].md - [对比案例数]

## 质量检查

- [ ] 所有文档已去除课程引用
- [ ] 索引已更新
- [ ] Git提交完成

## 下次计划

- [ ] 待同步内容...
```

---

## 🔧 快捷命令（可选）

**设置别名**（在 `~/.bashrc` 或 `~/.zshrc` 中）：

```bash
# 快速进入本地工作区
alias caselab='cd ~/dedao'

# 快速进入仓库
alias repo='cd ~/sanxiangwendao'

# 查看待同步文件
alias checksync='cd ~/dedao && git status'

# 同步到仓库
alias syncrepo='cd ~/sanxiangwendao && git pull && git add . && git status'
```

---

## 📊 同步频率建议

| 内容类型 | 建议频率 | 触发条件 |
|---------|---------|---------|
| **新案例** | 每周一次 | 完成2-3个案例后 |
| **新模型** | 每2周一次 | 提炼新模型后 |
| **新洞察** | 每月一次 | 跨案例对比完成后 |
| **系统指令** | 按需 | 仓库通知更新 |

---

## 💡 最佳实践

1. **小步快跑**：
   - 完成一个案例就同步一个
   - 不要积累太多未同步内容

2. **保持质量**：
   - 同步前必须质量检查
   - 宁可慢一点，不要返工

3. **及时更新索引**：
   - 每次同步都更新总索引
   - 索引是检索的入口

4. **记录同步日志**：
   - 维护同步记录
   - 方便复盘和追溯

---

**文档版本**：v1.0  
**创建日期**：2026-01-04  
**维护者**：常松阳  
**相关文档**：
- `shangye-anli/README.md` - 项目说明
- `99-gongjuSOP/知识库/知识库构建SOP.md` - 知识库构建流程
- `99-gongjuSOP/写作/新文档写作框架指南.md` - 写作规范
EOF

echo "✅ 同步SOP文档已创建"
echo ""
echo "文档路径: 99-gongjuSOP/协作/本地与仓库同步SOP.md"
echo "内容包括:"
echo "- 同步原则和核心规则"
echo "- 从本地→仓库的3种场景"
echo "- 从仓库→本地的2种场景"
echo "- 注意事项和检查清单"
echo "- 同步记录模板"
echo "- 快捷命令和最佳实践"

echo ""
echo "✅ Step 7 完成"
```

---

### Step 8：最终验证和报告

```bash
echo ""
echo "=========================================="
echo "Step 8: 最终验证和报告"
echo "=========================================="

# 生成验证报告
REPORT="/tmp/repo_cleanup_report.txt"
> $REPORT

echo "=== 仓库整理验证报告 ===" >> $REPORT
echo "生成时间: $(date)" >> $REPORT
echo "" >> $REPORT

# 1. YAML索引验证
echo "1. YAML索引验证" >> $REPORT
echo "---" >> $REPORT
echo "DOC-S04* 索引:" >> $REPORT
ls -lh rag-index/indexes/DOC-S04*.yaml >> $REPORT 2>&1
echo "" >> $REPORT
echo "DOC-S06* 索引:" >> $REPORT
ls -lh rag-index/indexes/DOC-S06*.yaml >> $REPORT 2>&1 || echo "✅ 无DOC-S06*文件（正确）" >> $REPORT
echo "" >> $REPORT

# 2. 空文件夹检查
echo "2. 空文件夹检查" >> $REPORT
echo "---" >> $REPORT
REMAINING_EMPTY=$(find . -type d -empty -not -path "./.git/*" 2>/dev/null | wc -l)
echo "剩余空文件夹数: $REMAINING_EMPTY" >> $REPORT
if [ $REMAINING_EMPTY -gt 0 ]; then
    echo "剩余空文件夹:" >> $REPORT
    find . -type d -empty -not -path "./.git/*" >> $REPORT 2>/dev/null
fi
echo "" >> $REPORT

# 3. 关键文件检查
echo "3. 关键文件检查" >> $REPORT
echo "---" >> $REPORT
echo "shangye-anli/README.md: $([ -f shangye-anli/README.md ] && echo '✅ 存在' || echo '❌ 缺失')" >> $REPORT
echo ".gitignore: $([ -f .gitignore ] && echo '✅ 存在' || echo '❌ 缺失')" >> $REPORT
echo "99-gongjuSOP/协作/本地与仓库同步SOP.md: $([ -f 99-gongjuSOP/协作/本地与仓库同步SOP.md ] && echo '✅ 存在' || echo '❌ 缺失')" >> $REPORT
echo "" >> $REPORT

# 4. 目录结构验证
echo "4. 目录结构" >> $REPORT
echo "---" >> $REPORT
tree -L 2 -d >> $REPORT 2>/dev/null || find . -type d -maxdepth 2 >> $REPORT

# 显示报告
echo ""
echo "=========================================="
echo "📊 整理验证报告"
echo "=========================================="
cat $REPORT

# 保存报告到仓库（可选）
cp $REPORT ./仓库整理报告-$(date +%Y%m%d).txt 2>/dev/null

echo ""
echo "✅ Step 8 完成"
echo ""
echo "=========================================="
echo "🎉 仓库整理全部完成！"
echo "=========================================="
echo ""
echo "完成的任务:"
echo "✅ Step 1: 备份当前状态"
echo "✅ Step 2: 删除重复YAML索引"
echo "✅ Step 3: 清理空文件夹"
echo "✅ Step 4: 更新shangye-anli/README.md"
echo "✅ Step 5: 更新.gitignore"
echo "✅ Step 6: 更新根目录README.md"
echo "✅ Step 7: 创建同步SOP"
echo "✅ Step 8: 生成验证报告"
echo ""
echo "📋 下一步建议:"
echo "1. 查看验证报告: cat /tmp/repo_cleanup_report.txt"
echo "2. 检查shangye-anli/README.md的更新"
echo "3. 检查根目录README.md的新增章节"
echo "4. 阅读同步SOP: 99-gongjuSOP/协作/本地与仓库同步SOP.md"
echo "5. Git提交所有更改"
echo ""
echo "🔧 Git提交命令（建议）:"
echo "git add ."
echo "git status  # 检查变更"
echo 'git commit -m "chore: 整理仓库结构，删除重复索引，添加协作SOP"'
echo "git push"
echo ""
```

---

## 执行说明

### 如何使用这个指令

1. **复制整个指令**到Cursor
2. **逐步执行**（建议）或一次性执行
3. **验证每一步**的结果

### 安全措施

- ✅ Step 1自动创建备份
- ✅ 所有文件操作前有存在性检查
- ✅ 删除操作前有确认提示（空文件夹）
- ✅ 重要文件自动备份（.backup后缀）

### 预期执行时间

- Step 1-2: 1分钟
- Step 3: 2-3分钟（取决于空文件夹数量）
- Step 4-7: 5-10分钟
- Step 8: 1分钟

**总计**: 约10-15分钟

---

## 验证清单

执行完成后，请确认：

- [ ] 重复YAML索引已删除（DOC-S067, DOC-S068）
- [ ] 空文件夹已清理
- [ ] shangye-anli/README.md已更新（有"本地工作区模式"说明）
- [ ] .gitignore已更新（包含dedao/和课程文件规则）
- [ ] 根目录README.md已更新（有"仓库结构说明"章节）
- [ ] 同步SOP已创建（99-gongjuSOP/协作/本地与仓库同步SOP.md）
- [ ] 验证报告已生成（/tmp/repo_cleanup_report.txt）

---

## 回滚方法（如果需要）

如果执行后发现问题，可以回滚：

```bash
# 恢复shangye-anli/README.md
cp shangye-anli/README.md.backup shangye-anli/README.md

# 恢复根目录README.md
cp README.md.backup README.md

# 恢复.gitignore
cp .gitignore.backup .gitignore

# 恢复YAML索引（如果需要）
# （从备份记录中查看原文件内容）
```

---

## 注意事项

1. **不会删除任何文档内容**：只删除重复索引和空文件夹
2. **所有重要文件自动备份**：.backup后缀
3. **Git未自动提交**：需要手动检查后提交
4. **本地dedao/不受影响**：不在仓库中，无需担心

---

请开始执行。执行完成后，你将拥有一个结构清晰、协作规范的知识库仓库！🚀

# 索引更新检查清单

> 每次新增文档到知识库时，请按此清单逐项检查，确保索引系统同步更新。

---

## 📋 更新步骤

### 步骤1：创建文档文件 ✅
- [ ] 在仓库根目录创建新的 Markdown 文档
- [ ] 确认文件名格式正确（与后续映射一致）

### 步骤2：更新 doc-mapping.md ✅
- [ ] 在 `rag-index/doc-mapping.md` 中添加文档ID映射
- [ ] 确认ID格式正确（DOC-DXXX 或 DOC-SXXX）
- [ ] 确认层级（dao/shu）和类型（theory/methodology/framework/technique/philosophy）正确

### 步骤3：更新 config.py ✅ **最容易忘记！**
- [ ] 在 `rag-system/config.py` 的 `DOC_MAPPING` 字典中添加条目
- [ ] 格式：`"DOC-XXX": "文档文件名.md",`
- [ ] 确认文件名与 doc-mapping.md 中的完全一致

### 步骤4：创建 YAML 索引文件 ✅
- [ ] 在 `rag-index/indexes/` 目录创建 `DOC-XXX.yaml`
- [ ] 参考 `rag-index/template.yaml` 填写字段
- [ ] 必填字段：doc_id, title, layer, doc_type, summary, keywords
- [ ] 建议填写：related_docs, query_patterns

### 步骤5：更新学习路径（可选）✅
- [ ] 如文档适合加入学习路径，更新 `rag-index/learning-paths.md`
- [ ] 选择合适的路径（创业实战/沟通影响/行为改变/战略思维等）
- [ ] 调整预期学习时长

### 步骤6：更新 README.md（可选）✅
- [ ] 如文档数量变化，更新统计数字
- [ ] 更新文档分类列表（如需要）
- [ ] 更新核心文档总数

### 步骤7：重建索引 ✅
- [ ] 运行 `python scripts/build_index.py` 重建向量索引
- [ ] 检查是否有错误信息
- [ ] 验证新文档是否成功索引

### 步骤8：测试查询 ✅
- [ ] 运行 `python scripts/test_query.py "新文档相关查询"`
- [ ] 确认新文档能被正确检索到
- [ ] 检查返回结果的相关性

---

## 🔍 快速验证命令

```bash
# 1. 检查 DOC_MAPPING 文档总数
python -c "from rag_system.config import DOC_MAPPING; print(f'文档总数: {len(DOC_MAPPING)}')"

# 2. 检查 doc-mapping.md 中的文档总数（手动数一下）

# 3. 检查 YAML 索引文件数量
ls rag-index/indexes/*.yaml | wc -l

# 4. 重建索引
python scripts/build_index.py

# 5. 测试查询
python scripts/test_query.py "你的测试查询"
```

---

## ⚠️ 常见错误

### 错误1：忘记更新 config.py
**症状**：运行 build_index.py 时提示 "未知的文档ID" 或某些文档无法被检索  
**解决**：检查 `rag-system/config.py` 的 `DOC_MAPPING` 是否包含所有文档

### 错误2：文件名不一致
**症状**：config.py 中的文件名与实际文件不匹配  
**解决**：确保 config.py、doc-mapping.md、实际文件名三者完全一致

### 错误3：YAML 格式错误
**症状**：build_index.py 报 YAML 解析错误  
**解决**：检查 YAML 文件格式，确保缩进正确，必填字段完整

### 错误4：忘记重建索引
**症状**：新文档无法被检索到  
**解决**：运行 `python scripts/build_index.py` 重建索引

---

## 📝 更新记录模板

每次更新索引后，可以在此记录：

```markdown
## 2024-XX-XX 更新记录

**新增文档**：
- DOC-XXX: 文档名.md

**更新内容**：
- [x] doc-mapping.md
- [x] config.py
- [x] YAML 索引文件
- [x] learning-paths.md（如需要）
- [x] README.md（如需要）
- [x] 重建索引

**验证结果**：
- 文档总数：XX篇
- 索引状态：✅ 正常
- 测试查询：✅ 通过
```

---

## 🎯 最佳实践

1. **一次更新，全部同步**：新增文档时，立即完成所有相关文件的更新，不要分多次完成
2. **先更新映射，再创建索引**：先更新 doc-mapping.md 和 config.py，再创建 YAML 文件
3. **更新后立即验证**：每次更新后运行验证命令，确保没有遗漏
4. **保持文件同步**：doc-mapping.md 和 config.py 必须始终保持同步

---

**最后更新**：2024年

